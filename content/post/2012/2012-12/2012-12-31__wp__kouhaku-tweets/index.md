+++
title = "紅白歌合戦に関するツイートを20万件ほど保存して遊んでみたお話"
date = "2012-12-31T23:58:56+09:00"
slug = "kouhaku-tweets"
draft = false

+++

<p>数年前に上京したときから、すっかりテレビのない日々に慣れてしまてしまっていて、また、ボンクレショ〜ガツは飛行機のチケットを取るのが大変なので北海道の実家に帰ることもなく、年末年始の特別番組とは無縁の生活を続けてきた。</p>
<p>しかし、今年、2012年は事情が少し違った。<a href="http://www1.nhk.or.jp/kouhaku/" title="第63回 NHK紅白歌合戦">第63回NHK紅白歌合戦</a>を観たかったのである。</p>
<p>かれこれ2年半ほど尊敬の眼差しを送り続けているゴールデンボンバー兄さんが出場する。ファンとしては、2012年の1月に「なんで2011年は紅白に呼ばれなかったんだ！」と叫び、もし呼ばれていたらこんな衣装でした、と「さよなら冬美」を歌った大阪城ホールでのライブを思い出す。</p>
<p><iframe width="640" height="360" src="http://www.youtube.com/embed/zGNE7epPtfc" frameborder="0" allowfullscreen></iframe></p>
<p>他には、きゃりーぱみゅぱみゅ先輩が出場する。ぼくは「もしもし原宿」のジャケット写真を真似してしまうほどの、ぱみゅ先輩の写真付きツイートはほぼすべてファブしてしまうほどの、ファンであった。</p>
<p><a href="http://www.flickr.com/photos/june29/6156998075/" title="Untitled by june29, on Flickr"><img src="http://farm7.staticflickr.com/6202/6156998075_c86af082db_z.jpg" alt="Untitled"></a></p>
<p>さらに、石川さゆりさんの歌唱シーンの背景映像を、漫画家の荒木飛呂彦先生が担当するというではないか。</p>
<blockquote class="twitter-tweet">
<p>今年の紅白の見たさ、観測史上最高な感じする。</p>
<p>— ⓙⓤⓝⓔ②⑨ (@june29) <a href="https://twitter.com/june29/status/283582073850167296" data-datetime="2012-12-25T14:36:49+00:00">December 25, 2012</a></p></blockquote>
<p>だが、冒頭に書いた通り、わたしの生活の中にはテレビがない。捨て猫みたいな俺達に、テレビを見る場所なんてもう何処にも無かった… Angel！</p>
<blockquote class="twitter-tweet" data-in-reply-to="283582283179491328">
<p>@<a href="https://twitter.com/june29">june29</a> 平民だけど観たければ来てもいいのよ</p>
<p>— Kana Natsuno (@kana1) <a href="https://twitter.com/kana1/status/283583026234019841" data-datetime="2012-12-25T14:40:36+00:00">December 25, 2012</a></p></blockquote>
<p>こうしてぼくは、ヴィム様のご厚意によって、紅白歌合戦を視聴するチャンスを掴んだのであった…！</p>
<h3>当日のこと</h3>
<p>紅白歌合戦の放映時間は、19:15から23:45までの4時間半である。これは、かなり長い。いくら今年のぼくの紅白熱が最高潮だとしても、270分もの間、黙って観賞を続けられるとは思えなかった。この270分は、せっかくの冬休みなので、自由研究の時間に充てようと思った。</p>
<p>そう考えて、紅白歌合戦の公式ハッシュタグである <a title="Twitter / Search - #NHK紅白" href="https://twitter.com/search/%23NHK%E7%B4%85%E7%99%BD">#NHK紅白</a> 付きのツイートをひたすらフェッチして保存するスクリプトを用意しておいた。</p>
<p>いよいよ訪れたその日、ぼくはヴィム様のもとを訪れ「あのとき助けていただいた捨て猫です」と一礼し、せめてものお礼を、と思い、鍋をつくってふるまった。ふたりで食べた。</p>
<h3>ツイートの収集</h3>
<p><a href="http://gifboom.com/x/67b3b712" style="color:transparent"><img src="http://medias.gifboom.com/medias/82d7d445ecbf4aaf863f22db2e1c0bc8@2x.gif"/></a></p>
<p>放送が始まった瞬間から、タイムラインの流速がけっこう早くて、おもしろいことになっていた。あまりにもツイートが多いとおかしくなるのか、Twitter さんがたまに変なレスポンスを返してきて JSON パーサが「だめです、パースできません！」とか言って死ぬときがあった。死因を特定しては、死を回避するような処理をスクリプトに追加して、少しずつ安定運用に近付いていった。</p>
<p>コンソールを流れるツイートのことは気にかけつつも、ふつうにテレビを観たり、雑談したり、鍋を食べていたりしたので、途中、スクリプトが死んでいることに気付かずに2〜3分ほどツイートを収集できていない虚無の時間帯を発生させてしまったのは失敗だ…</p>
<p>ほいで、ヴィム様にご指導を受けて、以下のようなシェルスクリプトを書いて、スクリプトが死んだら say してすぐに再実行、みたいな体制に落ち着いた。</p>
<p><script src="https://gist.github.com/4427981.js"></script></p>
<h3>収集したツイートの集計</h3>
<p>案の定、ゴールデンボンバー兄さんときゃりーぱみゅぱみゅ先輩の登場を見届けたあと、だんだんと時間を持て余すようになったので、ツイート収集スクリプトを見守りながらも、並行して、ツイートの集計について考え始めた。</p>
<p>とりあえず、放送時間中の「盛り上がりチャート」みたいなものはつくりたくて、かつ、それを HTML として公開するところまでは勢いで済ませてしまいたかったので、そこをめがけて作業を進めた。</p>
<p>JavaScript のチャート作成ライブラリみたいなものは、いくつか知っていた。幸いなことにヴィム様がこのあたりに詳しかったので、何種類かのライブラリのデモページを見たあと、パッと「これにしよー」と言って <a href="http://www.highcharts.com/" title="Highcharts - Interactive JavaScript charts for your webpage">Highcharts &#8211; Interactive JavaScript charts for your webpage</a> を採用した。</p>
<p>Highcharts が受け取ることのできるデータフォーマットについて調べつつ、保存したツイートを集計するスクリプトの設計について議論を進めた。</p>
<p>ここが自然にペアプロの形になり、ぼくがドライバーとしてハンドルを握る横でヴィム様がナビゲーターを務めてくれて、とても楽しいドライヴになった。</p>
<p>ヴィム様は思考の速度が早いだけでなく、引き出しがとても充実している印象を受けた。ぼくは積極的に「ここでやりたいのは、こういうこと」を伝えるために紙にペンを走らせたり疑似コードを書いたりしてコミュニケーションをはかり、そうするとヴィム様は「C#だと、こういう方法を使うんだけど、Rubyだと？」「ここは、そろそろメソッドに切り出した方がいい」と、いい感じに導いてくれて、すごく楽しかった。</p>
<p>それから、ぼくが Emacs の操作でもたつくと「え〜？え〜？？」と困った顔を見せ「そこを手作業でやっちゃいますか〜」「3手、私のVimなら3手だ」などと愛に満ちた檄を飛ばしてくださり、コーディング環境についても学びが多かった。</p>
<p>今回のような、おもちゃみたいなスクリプトを書くときにも、相手が素敵だと、とても充実したプログラミングタイムを満喫することができる。そんな満ち足りた心情をツイートにして吐き出していたら、まわりからも反応があった。</p>
<blockquote class="twitter-tweet" data-in-reply-to="285745731711680513">
<p>@<a href="https://twitter.com/june29">june29</a> 羨ましい</p>
<p>— risou (@risou) <a href="https://twitter.com/risou/status/285749589317914624" data-datetime="2012-12-31T14:09:45+00:00">December 31, 2012</a></p></blockquote>
<blockquote class="twitter-tweet">
<p>じゅーんさんとペアプロしたい</p>
<p>— Kazuhito Hokamura (@hokaccha) <a href="https://twitter.com/hokaccha/status/285791856242081792" data-datetime="2012-12-31T16:57:42+00:00">December 31, 2012</a></p></blockquote>
<p>アラサーのみなさんも、そうじゃないみなさんも、ぜひペアプロしましょう！楽しそう！</p>
<p>そんなこんなキャッキャと過ごしている間に、いつの間にか新年を迎えていた。ハッピーニューイヤー、2013年！！！</p>
<h3>成果物</h3>
<p>こんな感じで、1分ごとのツイート数をチャート化してみた。</p>
<p><img src="http://c714091.r91.cf2.rackcdn.com/9850fdfb4b64c802f67b454b2b77aa58db9ad69c70.png" alt=""></p>
<p><a href="http://june29.github.com/kouhaku-tweets/" title="KOUHAKU Tweets">KOUHAKU Tweets</a></p>
<p>「全ツイート」の他にも「指定のアーティスト名を含む」を条件としてフィルタした場合の数を何種類か出してみた。</p>
<p>ツイートの JSON をゴロンと保存してあるので、たとえば「最もよくリツイートされたツイート」なんかも出せるし、色々と遊べそうではあるのだけれど、けっこういい時間になっていたので、ひとまずこの状態で公開し、ヴィム様に迷惑を掛けすぎる前に帰路に着くことを選んだ。</p>
<h3>まとめ</h3>
<p><a href="http://gifboom.com/x/3c97e1d9" style="color:transparent"><img src="http://medias.gifboom.com/medias/4b018093a7ea432c981341f00d25c0c9@2x.gif"></a><a href="http://gifboom.com/x/85429cf5" style="color:transparent"><img src="http://medias.gifboom.com/medias/f454aed681574cec9f471d8531637c98@2x.gif"></a></p>
<p>数年ぶりに「NHK紅白歌合戦」を観て楽しんだ。ゴールデンボンバー兄さんに関しては<a href="http://mainichi.jp/mantan/news/20121229dyo00m200042000c.html" title="紅白リハ:NHKのCPが金爆にピシャリ「勘違いしている節がある」－ 毎日ｊｐ(毎日新聞)">直前の報道</a>のこともあったりしてかなりドキドキハラハラしながら過ごしていたのだけれど、とてもいい感じにイベントを盛り上げていて、なんだか「ホッとした」ってのが感想だ。素晴らしいステージだった。</p>
<blockquote class="twitter-tweet">
<p>ゴールデンボンバー、ステージ後のコメント「真面目にやりました」　<a href="https://twitter.com/search/%23NHK紅白">#NHK紅白</a></p>
<p>— NHK紅白歌合戦 (@nhk_kouhaku) <a href="https://twitter.com/nhk_kouhaku/status/285699869950230528" data-datetime="2012-12-31T10:52:11+00:00">December 31, 2012</a></p></blockquote>
<p>ツイートの収集から集計、チャート化まで、準備時間をあまり確保できなかったにも関わらず、けっこうスムーズに進められて楽しかった。たとえば大学院時代のぼくが取り組んでいたら「収集で失敗する」確率もけっこう高かっただろうし、保存の形式の設計や、集計スクリプトを繰り返し実行できるようにする工夫も、そんなに上手くいかなくて、今回の5倍くらいは労力がかかっていたと思う。「ちょっとしたことを上手くやれる」ようになると、今回みたいなお遊戯が、俄然、楽しくなる。ヴィム様みたいな人が隣にいてくれると、なおのことだ。ペアプロに夢中になりながらの年越しは初めてのことで、すごく楽しかった。</p>
<p><script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script></p>
